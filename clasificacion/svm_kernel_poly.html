<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVM: Kernel Polinomial - Proyecci√≥n 3D</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #16a085;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --bg-light: #f4f7f6;
            --card-bg: #ffffff;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-light);
            padding: 20px;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--secondary-color);
        }

        .container {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            width: 95%;
            max-width: 1500px;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            margin: 0;
            color: var(--secondary-color);
            font-size: 1.8em;
        }

        p.subtitle {
            color: #7f8c8d;
            font-size: 0.95em;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--secondary-color);
            color: white;
            text-decoration: none;
            border-radius: 30px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            background-color: #34495e;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .main-layout {
            display: grid;
            grid-template-columns: 280px 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        @media (max-width: 1100px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        .controls-panel {
            background-color: #e8f6f3;
            padding: 20px;
            border-radius: 10px;
            height: fit-content;
            border: 1px solid #d1f2eb;
        }

        .equation-box {
            background: #fff;
            padding: 12px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
            color: #333;
        }

        .control-group {
            margin-bottom: 12px;
            background: white;
            padding: 10px 12px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .control-group input[type=range] {
            width: 100%;
            cursor: pointer;
        }

        .val-display {
            float: right;
            color: var(--primary-color);
            font-family: monospace;
            font-weight: bold;
        }

        .chart-container {
            background: white;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #eee;
            height: 500px;
        }

        .chart-header {
            text-align: center;
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 10px;
            padding: 8px;
            background: linear-gradient(135deg, #ecf0f1, #fff);
            border-radius: 8px;
        }

        .chart-header span {
            color: var(--primary-color);
        }

        .transformation-box {
            background: linear-gradient(135deg, var(--primary-color), #1abc9c);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
        }

        .transformation-box h4 {
            margin: 0 0 10px 0;
            font-size: 0.95em;
        }

        .transformation-box .formula {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }

        .insight-panel {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            grid-column: span 2;
        }

        @media (max-width: 1100px) {
            .insight-panel {
                grid-column: span 1;
            }
        }

        .insight-panel h4 {
            margin: 0 0 10px 0;
        }

        .insight-panel p {
            margin: 5px 0;
            font-size: 0.85em;
        }

        .legend-custom {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 10px;
            font-size: 0.85em;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .degree-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
        }

        .degree-btn {
            padding: 8px 16px;
            border: 2px solid var(--primary-color);
            background: white;
            color: var(--primary-color);
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .degree-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .degree-btn:hover {
            transform: scale(1.05);
        }

        .info-text {
            font-size: 0.8em;
            color: #666;
            margin-top: 15px;
            background: #fff;
            padding: 12px;
            border-radius: 8px;
        }
    </style>
</head>

<body>

    <div class="container">
        <a href="../index.html" class="btn">‚Üê Volver al Men√∫</a>

        <header>
            <h1>üîÆ El Truco del Kernel: Proyecci√≥n Polinomial</h1>
            <p class="subtitle">Visualiza c√≥mo datos NO separables en 2D se vuelven SEPARABLES en un espacio de mayor
                dimensi√≥n.</p>
        </header>

        <div class="main-layout">

            <!-- Controls -->
            <div class="controls-panel">
                <h3 style="margin-top:0;">Par√°metros</h3>

                <div class="equation-box">
                    <strong>Kernel Polinomial:</strong><br><br>
                    K(x, x') = (x ¬∑ x' + c)<sup>d</sup>
                    <hr style="border:0; border-top:1px solid #eee; margin:8px 0;">
                    <strong>d</strong> = grado del polinomio<br>
                    <strong>c</strong> = t√©rmino independiente
                </div>

                <div class="control-group">
                    <label>Grado (d) <span id="val_degree" class="val-display">2</span></label>
                    <div class="degree-indicator">
                        <button class="degree-btn" onclick="setDegree(1)">1</button>
                        <button class="degree-btn active" onclick="setDegree(2)">2</button>
                        <button class="degree-btn" onclick="setDegree(3)">3</button>
                    </div>
                    <small style="color:#888; font-size:0.75em;">d=1: Lineal, d=2: Cuadr√°tico, d=3: C√∫bico</small>
                </div>

                <div class="control-group">
                    <label>Coeficiente (c) <span id="val_coef" class="val-display">0.5</span></label>
                    <input type="range" id="in_coef" min="0" max="2" step="0.1" value="0.5">
                </div>

                <div class="control-group">
                    <label>Patr√≥n de Datos</label>
                    <select id="in_pattern" style="width:100%; padding:8px; border-radius:5px; border:1px solid #ddd;">
                        <option value="circles">C√≠rculos Conc√©ntricos</option>
                        <option value="xor">Patr√≥n XOR</option>
                    </select>
                </div>

                <button class="btn" onclick="regenerateData()" style="width:100%; margin-top:10px; font-size:0.9em;">
                    üîÑ Regenerar Datos
                </button>

                <div class="transformation-box">
                    <h4>üöÄ Transformaci√≥n Aplicada</h4>
                    <div class="formula" id="transform_formula">
                        (x‚ÇÅ, x‚ÇÇ) ‚Üí (x‚ÇÅ¬≤, ‚àö2¬∑x‚ÇÅ¬∑x‚ÇÇ, x‚ÇÇ¬≤)
                    </div>
                </div>

                <div class="info-text">
                    <strong>¬øPor qu√© funciona?</strong><br>
                    El kernel polinomial proyecta impl√≠citamente los datos a un espacio de mayor dimensi√≥n donde un
                    hiperplano lineal puede separarlos.
                </div>
            </div>

            <!-- 2D View -->
            <div>
                <div class="chart-header">
                    üìä Espacio Original <span>(2D)</span>
                </div>
                <div class="chart-container" id="chart2D"></div>
                <div class="legend-custom">
                    <div class="legend-item">
                        <div class="legend-dot" style="background:#3498db;"></div>
                        <span>Clase +1</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background:#e74c3c;"></div>
                        <span>Clase -1</span>
                    </div>
                </div>
            </div>

            <!-- 3D View -->
            <div>
                <div class="chart-header">
                    üîÆ Espacio Transformado <span>(3D)</span>
                </div>
                <div class="chart-container" id="chart3D"></div>
                <p style="text-align:center; font-size:0.8em; color:#888; margin-top:5px;">
                    ‚ÜïÔ∏è Arrastra para rotar | üîç Scroll para zoom
                </p>
            </div>

            <!-- Insight Panel -->
            <div class="insight-panel" id="insight_panel">
                <h4>üí° Observaci√≥n Clave</h4>
                <p id="insight_text">
                    Con grado d=2, los c√≠rculos conc√©ntricos se separan en el eje Z (altura).
                    El c√≠rculo interior queda "arriba" y el exterior "abajo", permitiendo una separaci√≥n lineal en 3D.
                </p>
            </div>

        </div>
    </div>

    <script>
        // --- Data ---
        let dataX = [], dataY = [], dataLabels = [];
        const n_points = 60;
        let currentDegree = 2;

        function generateCirclesData() {
            dataX = []; dataY = []; dataLabels = [];
            let seed = Math.random() * 1000;
            function random() {
                let x = Math.sin(seed++) * 10000;
                return x - Math.floor(x);
            }

            // Inner circle (class +1) - easier to see separation
            for (let i = 0; i < n_points / 2; i++) {
                let angle = 2 * Math.PI * random();
                let r = 0.3 + random() * 0.15;
                dataX.push(r * Math.cos(angle));
                dataY.push(r * Math.sin(angle));
                dataLabels.push(1);
            }

            // Outer circle (class -1)
            for (let i = 0; i < n_points / 2; i++) {
                let angle = 2 * Math.PI * random();
                let r = 0.8 + random() * 0.2;
                dataX.push(r * Math.cos(angle));
                dataY.push(r * Math.sin(angle));
                dataLabels.push(-1);
            }
        }

        function generateXORData() {
            dataX = []; dataY = []; dataLabels = [];
            let seed = Math.random() * 1000;
            function random() {
                let x = Math.sin(seed++) * 10000;
                return x - Math.floor(x);
            }

            const offset = 0.6;
            const spread = 0.2;

            // Quadrant 1 & 3 (+1)
            for (let i = 0; i < n_points / 4; i++) {
                dataX.push(offset + (random() - 0.5) * spread);
                dataY.push(offset + (random() - 0.5) * spread);
                dataLabels.push(1);
            }
            for (let i = 0; i < n_points / 4; i++) {
                dataX.push(-offset + (random() - 0.5) * spread);
                dataY.push(-offset + (random() - 0.5) * spread);
                dataLabels.push(1);
            }

            // Quadrant 2 & 4 (-1)
            for (let i = 0; i < n_points / 4; i++) {
                dataX.push(-offset + (random() - 0.5) * spread);
                dataY.push(offset + (random() - 0.5) * spread);
                dataLabels.push(-1);
            }
            for (let i = 0; i < n_points / 4; i++) {
                dataX.push(offset + (random() - 0.5) * spread);
                dataY.push(-offset + (random() - 0.5) * spread);
                dataLabels.push(-1);
            }
        }

        function regenerateData() {
            const pattern = document.getElementById('in_pattern').value;
            if (pattern === 'circles') generateCirclesData();
            else if (pattern === 'xor') generateXORData();
            update();
        }

        // --- Polynomial Feature Transformation ---
        function transformPoint(x, y, degree, coef) {
            // Map 2D to 3D based on polynomial degree
            if (degree === 1) {
                // Linear: just add a constant dimension
                return { z: coef };
            } else if (degree === 2) {
                // Quadratic: œÜ(x,y) = (x¬≤, ‚àö2xy, y¬≤) - but we'll use x¬≤ + y¬≤ for visualization
                // This is the classic transformation that separates circles
                return { z: x * x + y * y + coef };
            } else if (degree === 3) {
                // Cubic: more complex transformation
                return { z: x * x * x + y * y * y + x * y * (x + y) + coef };
            }
            return { z: x * x + y * y };
        }

        function setDegree(d) {
            currentDegree = d;
            document.querySelectorAll('.degree-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.degree-btn')[d - 1].classList.add('active');
            document.getElementById('val_degree').innerText = d;
            update();
        }

        // --- DOM ---
        const sliderCoef = document.getElementById('in_coef');
        const valCoef = document.getElementById('val_coef');
        const insightText = document.getElementById('insight_text');
        const transformFormula = document.getElementById('transform_formula');

        // --- Update ---
        function update() {
            const degree = currentDegree;
            const coef = parseFloat(sliderCoef.value);

            valCoef.innerText = coef.toFixed(1);

            // Update formula display
            if (degree === 1) {
                transformFormula.innerHTML = '(x‚ÇÅ, x‚ÇÇ) ‚Üí (x‚ÇÅ, x‚ÇÇ, c)<br><small>Sin transformaci√≥n real</small>';
            } else if (degree === 2) {
                transformFormula.innerHTML = '(x‚ÇÅ, x‚ÇÇ) ‚Üí (x‚ÇÅ, x‚ÇÇ, x‚ÇÅ¬≤ + x‚ÇÇ¬≤ + c)';
            } else if (degree === 3) {
                transformFormula.innerHTML = '(x‚ÇÅ, x‚ÇÇ) ‚Üí (x‚ÇÅ, x‚ÇÇ, x‚ÇÅ¬≥ + x‚ÇÇ¬≥ + x‚ÇÅx‚ÇÇ(x‚ÇÅ+x‚ÇÇ) + c)';
            }

            // Update insight
            const pattern = document.getElementById('in_pattern').value;
            if (degree === 1) {
                insightText.innerHTML = '‚ö†Ô∏è <strong>Grado 1 (Lineal):</strong> No hay transformaci√≥n real. Las clases siguen sin ser separables linealmente en el espacio 3D.';
            } else if (degree === 2 && pattern === 'circles') {
                insightText.innerHTML = '‚úÖ <strong>¬°Magia del Kernel!</strong> Con d=2, los c√≠rculos se separan por altura (Z). El c√≠rculo interior tiene r¬≤ peque√±o ‚Üí Z bajo. El exterior tiene r¬≤ grande ‚Üí Z alto. ¬°Ahora un plano horizontal puede separarlos!';
            } else if (degree === 2 && pattern === 'xor') {
                insightText.innerHTML = '‚úÖ <strong>Patr√≥n XOR resuelto!</strong> La transformaci√≥n cuadr√°tica mapea los cuadrantes opuestos a alturas similares, permitiendo separaci√≥n lineal en 3D.';
            } else if (degree === 3) {
                insightText.innerHTML = 'üî¨ <strong>Grado 3 (C√∫bico):</strong> Transformaci√≥n m√°s compleja. Puede capturar patrones m√°s intrincados pero aumenta el riesgo de overfitting.';
            }

            // Separate by class
            const class1_x = [], class1_y = [], class1_z = [];
            const class0_x = [], class0_y = [], class0_z = [];

            for (let i = 0; i < dataX.length; i++) {
                const { z } = transformPoint(dataX[i], dataY[i], degree, coef);

                if (dataLabels[i] === 1) {
                    class1_x.push(dataX[i]);
                    class1_y.push(dataY[i]);
                    class1_z.push(z);
                } else {
                    class0_x.push(dataX[i]);
                    class0_y.push(dataY[i]);
                    class0_z.push(z);
                }
            }

            // --- 2D Plot ---
            let trace2D_1 = {
                x: class1_x, y: class1_y,
                mode: 'markers',
                name: 'Clase +1',
                marker: { size: 12, color: '#3498db', symbol: 'circle', line: { width: 1, color: '#2980b9' } }
            };

            let trace2D_0 = {
                x: class0_x, y: class0_y,
                mode: 'markers',
                name: 'Clase -1',
                marker: { size: 12, color: '#e74c3c', symbol: 'circle', line: { width: 1, color: '#c0392b' } }
            };

            // Add annotation showing non-separability
            let layout2D = {
                xaxis: { title: 'x‚ÇÅ', range: [-1.5, 1.5], zeroline: true, zerolinecolor: '#ccc' },
                yaxis: { title: 'x‚ÇÇ', range: [-1.5, 1.5], zeroline: true, zerolinecolor: '#ccc' },
                margin: { t: 20, b: 50, l: 50, r: 20 },
                showlegend: false,
                annotations: [{
                    x: 0, y: 1.3,
                    xref: 'x', yref: 'y',
                    text: '‚ùå No separable linealmente',
                    showarrow: false,
                    font: { size: 12, color: '#e74c3c' }
                }]
            };

            Plotly.react('chart2D', [trace2D_0, trace2D_1], layout2D);

            // --- 3D Plot ---
            let trace3D_1 = {
                x: class1_x, y: class1_y, z: class1_z,
                mode: 'markers',
                type: 'scatter3d',
                name: 'Clase +1',
                marker: { size: 6, color: '#3498db', symbol: 'circle', line: { width: 0.5, color: '#2980b9' } }
            };

            let trace3D_0 = {
                x: class0_x, y: class0_y, z: class0_z,
                mode: 'markers',
                type: 'scatter3d',
                name: 'Clase -1',
                marker: { size: 6, color: '#e74c3c', symbol: 'circle', line: { width: 0.5, color: '#c0392b' } }
            };

            // Add separating plane if degree >= 2
            let traces3D = [trace3D_0, trace3D_1];

            if (degree >= 2) {
                // Calculate separator z-value (midpoint between classes)
                const avgZ1 = class1_z.reduce((a, b) => a + b, 0) / class1_z.length;
                const avgZ0 = class0_z.reduce((a, b) => a + b, 0) / class0_z.length;
                const separatorZ = (avgZ1 + avgZ0) / 2;

                // Create separating plane
                let planeX = [[-1.5, 1.5], [-1.5, 1.5]];
                let planeY = [[-1.5, -1.5], [1.5, 1.5]];
                let planeZ = [[separatorZ, separatorZ], [separatorZ, separatorZ]];

                let tracePlane = {
                    x: planeX.flat(),
                    y: planeY.flat(),
                    z: planeZ.flat(),
                    type: 'mesh3d',
                    i: [0, 0],
                    j: [1, 2],
                    k: [2, 3],
                    opacity: 0.4,
                    color: '#2ecc71',
                    name: 'Hiperplano Separador'
                };

                traces3D.push(tracePlane);
            }

            let layout3D = {
                scene: {
                    xaxis: { title: 'x‚ÇÅ', range: [-1.5, 1.5] },
                    yaxis: { title: 'x‚ÇÇ', range: [-1.5, 1.5] },
                    zaxis: { title: 'œÜ(x)', range: [0, Math.max(...class1_z, ...class0_z) * 1.2] },
                    camera: {
                        eye: { x: 1.5, y: 1.5, z: 1.2 }
                    },
                    annotations: degree >= 2 ? [{
                        x: 0, y: 0,
                        z: (class1_z.reduce((a, b) => a + b, 0) / class1_z.length + class0_z.reduce((a, b) => a + b, 0) / class0_z.length) / 2,
                        text: '‚úÖ ¬°Separable!',
                        showarrow: false,
                        font: { size: 14, color: '#27ae60' }
                    }] : []
                },
                margin: { t: 20, b: 20, l: 20, r: 20 },
                showlegend: false
            };

            Plotly.react('chart3D', traces3D, layout3D);
        }

        // --- Events ---
        sliderCoef.addEventListener('input', update);
        document.getElementById('in_pattern').addEventListener('change', regenerateData);

        // --- Init ---
        generateCirclesData();
        update();

        window.onresize = function () {
            Plotly.Plots.resize('chart2D');
            Plotly.Plots.resize('chart3D');
        };
    </script>
</body>

</html>