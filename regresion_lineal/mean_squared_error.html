<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regresión y Función de Costo</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        /* --- Reuse Styles from Index/Logistic --- */
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            /* Blue for Regression */
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #333;
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            padding: 20px 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .back-btn {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            text-decoration: none;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            transition: background 0.3s;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }

        /* --- Controls Sidebar --- */
        .sidebar {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            height: fit-content;
        }

        .control-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.9em;
        }

        input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .value-display {
            font-family: monospace;
            color: var(--accent-color);
            float: right;
        }

        .equation-box {
            background: #f1f2f6;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent-color);
        }

        .metrics-box {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 25px;
            border: 1px solid #bce0fd;
        }

        #mseDisplay {
            color: #e74c3c;
            font-weight: bold;
            font-size: 1.5em;
            display: block;
            margin-top: 5px;
        }

        /* --- Main Visualization --- */
        .main-content {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .plot-container {
            width: 100%;
            height: 400px;
            border: 1px solid #eee;
            border-radius: 8px;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

    <header>
        <a href="../index.html" class="back-btn">← Volver</a>
        <h1>Simulador de Regresión Lineal</h1>
        <p>Visualizando el Espacio de Datos y la Función de Costo</p>
    </header>

    <div class="container">
        <!-- Sidebar Controls -->
        <aside class="sidebar">
            <h3>Parámetros</h3>
            <p style="font-size: 0.8em; color: #7f8c8d;">Ajusta m y b para minimizar el error.</p>

            <div class="equation-box">
                MSE = (1/N) Σ (yᵢ - ŷᵢ)²<br>
                ŷᵢ = mxᵢ + b
            </div>

            <div class="metrics-box">
                <label style="margin:0;">Error Cuadrático Medio</label>
                <span id="mseDisplay">0.00</span>
            </div>

            <div class="control-group">
                <label>Pendiente (m) <span id="slopeVal" class="value-display">1.0</span></label>
                <input type="range" id="slope" min="-5" max="10" step="0.1" value="1">
            </div>

            <div class="control-group">
                <label>Intercepto (b) <span id="interceptVal" class="value-display">0.0</span></label>
                <input type="range" id="intercept" min="-5" max="10" step="0.1" value="0">
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div id="plotRegression" class="plot-container"></div>
            <div id="plotCost" class="plot-container"></div>
        </main>
    </div>

    <script>
        // --- 1. Generación de Datos ---
        const N = 30;
        let xData = [];
        let yData = [];

        // Relación real: y = 3x + 4 + ruido
        let seed = 123;
        function random() {
            let x = Math.sin(seed++) * 10000;
            return x - Math.floor(x);
        }

        for (let i = 0; i < N; i++) {
            let x = random() * 2;
            let noise = (random() - 0.5) * 4;
            let y = 3 * x + 4 + noise;
            xData.push(x);
            yData.push(y);
        }

        // --- 2. Elementos DOM ---
        const sliderM = document.getElementById('slope');
        const sliderB = document.getElementById('intercept');
        const labelM = document.getElementById('slopeVal');
        const labelB = document.getElementById('interceptVal');
        const labelMSE = document.getElementById('mseDisplay');

        // --- 3. Función auxiliar para calcular MSE ---
        function calculateMSE(m, b) {
            let sumError = 0;
            for (let i = 0; i < N; i++) {
                let pred = m * xData[i] + b;
                sumError += Math.pow(yData[i] - pred, 2);
            }
            return sumError / N;
        }

        // --- 4. Función Principal de Actualización ---
        function updatePlots() {
            // Valores actuales
            let currentM = parseFloat(sliderM.value);
            let currentB = parseFloat(sliderB.value);

            // Actualizar textos
            labelM.innerText = currentM.toFixed(1);
            labelB.innerText = currentB.toFixed(1);

            // --- GRÁFICO 1: REGRESIÓN (Data Space) ---
            let yPred = xData.map(x => currentM * x + currentB);

            // Líneas rojas de error (Shapes)
            let errorLines = [];
            for (let i = 0; i < N; i++) {
                errorLines.push({
                    type: 'line',
                    x0: xData[i], y0: yData[i],
                    x1: xData[i], y1: yPred[i],
                    line: { color: 'red', width: 1, dash: 'dot' }
                });
            }

            let tracePoints = {
                x: xData,
                y: yData,
                mode: 'markers',
                name: 'Datos',
                marker: { size: 10, color: '#3498db' }
            };

            let traceLine = {
                x: [0, 2.5],
                y: [currentB, currentM * 2.5 + currentB],
                mode: 'lines',
                name: 'Predicción',
                line: { color: '#27ae60', width: 4 }
            };

            let layoutReg = {
                title: 'Espacio de Datos (x, y)',
                xaxis: { title: 'Variable X', range: [-0.1, 2.3] },
                yaxis: { title: 'Variable Y', range: [0, 15] },
                shapes: errorLines,
                margin: { t: 40, b: 40, l: 40, r: 20 },
                showlegend: false,
                hovermode: 'closest'
            };

            // --- GRÁFICO 2: CURVA DE COSTO (Parameter Space) ---
            // Aquí calculamos cómo cambia el error si movemos SOLO la pendiente (m)
            // manteniendo el intercepto (b) fijo en su valor actual.

            let mRangeX = [];
            let errorCurveY = [];

            // Generamos puntos para dibujar la parábola completa (de -5 a 10)
            for (let m = -5; m <= 10; m += 0.5) {
                mRangeX.push(m);
                errorCurveY.push(calculateMSE(m, currentB));
            }

            let currentMSE = calculateMSE(currentM, currentB);
            labelMSE.innerText = currentMSE.toFixed(2);

            let traceCurve = {
                x: mRangeX,
                y: errorCurveY,
                mode: 'lines',
                name: 'Curva de Error',
                line: { color: '#bdc3c7', width: 3, dash: 'dash' }
            };

            let traceBall = {
                x: [currentM],
                y: [currentMSE],
                mode: 'markers',
                name: 'Tu Posición',
                marker: {
                    size: 16,
                    color: '#e74c3c',
                    line: { color: 'black', width: 2 }
                }
            };

            let layoutCost = {
                title: `Función de Costo (J) para b=${currentB.toFixed(1)}`,
                xaxis: { title: 'Valor de Pendiente (m)' },
                yaxis: { title: 'Error (MSE)' },
                margin: { t: 40, b: 40, l: 40, r: 20 },
                showlegend: false,
                annotations: [{
                    x: currentM,
                    y: currentMSE,
                    text: 'Estás aquí',
                    showarrow: true,
                    arrowhead: 2,
                    ax: 0,
                    ay: -40
                }]
            };

            // Renderizar ambos gráficos
            Plotly.react('plotRegression', [tracePoints, traceLine], layoutReg);
            Plotly.react('plotCost', [traceCurve, traceBall], layoutCost);
        }

        // Listeners
        sliderM.addEventListener('input', updatePlots);
        sliderB.addEventListener('input', updatePlots);

        // Inicio
        updatePlots();

        // Re-ajustar gráficos al cambiar tamaño de ventana
        window.onresize = function () {
            Plotly.Plots.resize('plotRegression');
            Plotly.Plots.resize('plotCost');
        };

    </script>
</body>

</html>